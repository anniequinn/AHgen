---
title: "5 - Visualisation"
author: 
 - Annie Visser-Quinn & Melissa Bedinger
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    theme: paper
    highlight: haddock
vignette: >
  %\VignetteIndexEntry{Vignette 3 - Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, cache = TRUE, message = FALSE, warning = FALSE)

rm(list = ls()); cat("\014")

library(knitr)
library(tidyverse)
library(igraph)
library(AHgen)
```

<style>
#TOC {
  background: url("images/hex.png");
  background-size: 240px;
  background-position-x: center;
  background-position-y: top;
  padding-top: 280px !important;
  background-repeat: no-repeat;
}
</style>

```{r include = FALSE}
dh <- read_adjMat("../inputs/mobilityAH_adjMat_20230629.xlsx") 
dv <- dh %>% select(level, levelName_full, levelName, Node)
de <- dh %>% adjMat_to_edgelist(vInfo = dv)
di <- dh %>% adjMat_to_igraph(vInfo = dv)
di_w <- weightEdges(de, read_xlsx("../inputs/mobilityAH_edges_exampleWeights_20230629.xlsx")) %>% edgelist_to_igraph(vInfo = dv)
```

<span style="color: red;">Text goes here</span>

Create a visKey. Could also do it external to R and import.

```{r}
visKey <-
  tribble(~layer, ~min, ~max, ~addR, ~r,
        1,250,290,0,1,
        2,250,290,0,2,
        3,260,280,0,3,
        4,260,280,0,4,
        5,250,290,0,5)

visKey
```

Explain what arguments vis_layout has.

<span style="color: red;">There are some errors manifesting in the node positions that needs to be checked</span>



```{r}
plot_layout <- vis_layout(edgelist = de, 
                          vInfo = dv, 
                          minSpacing = 0, maxSpacing = 1000, 
                          key = visKey)
plot_layout
```

Function to quickly plot a ggplot.
Can still edit this in situ.
Or start from scratch.
If key is specified, the circles are drawn??

```{r}
plot_ggplot <- vis_ggplot(plot_layout, key = visKey)
plot_ggplot
```

Lastly is plotly. 

```{r} 
plot_plotly <- vis_plotly(plot_ggplot, circles = TRUE)
plot_plotly
```

You can also find an interactive AHexplorer at: and the code underlying it at:.

Using the building blocks above, it is possible to create an interactive version of an Abstraction Hierarchy. Below you can explore the AHexploreR, an application of this for a generic UK city (the Urban Systems Abstraction Hierarchy, or USAH). You can also find the AHexploreR at: https://mbedinger.shinyapps.io/AHexploreR.

```{r, echo = FALSE}
knitr::include_app("https://mbedinger.shinyapps.io/AHexploreR/", height = "800px")
```

## Last updated
This vignette is associated with AHgen v1.0, and was last updated by Melissa Bedinger on 2023-07-03.