---
title: "Visualise"
author: 
 - Annie Visser-Quinn & Melissa Bedinger
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    theme: paper
    highlight: haddock
vignette: >
  %\VignetteIndexEntry{Vignette 6 - Visualise}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE)

rm(list = ls()); cat("\014")

library(knitr)
library(tidyverse)
library(AHgen)
```

<style>
#TOC {
  background: url("images/hex.png");
  background-size: 230px;
  background-position-x: center;
  background-position-y: top;
  padding-top: 280px !important;
  background-repeat: no-repeat;
}
</style>

---

In this vignette, you will find out about pre-set visualisations in `AHgen`:

- Section 1 - Visualising the Abstraction Hierarchy
- Section 2 - Visualising and exploring results

To navigate to other vignettes, go to [Vignette 0 - Welcome to AHgen](Vignette-0---Welcome-to-AHgen.html).


## 1. Visualising the Abstraction Hierarchy

This section will cover pre-set visualisations for the Abstraction Hierarchy itself.
```{r include = FALSE}
dh <- read_adjMat("../inputs/mobilityAH_adjMat_20230629.xlsx") 
dv <- dh %>% select(level, levelName_full, levelName, Node)
de <- dh %>% adjMat_to_edgelist(vInfo = dv)
di <- dh %>% adjMat_to_igraph(vInfo = dv)
di_w <- 
  weight_edges(de, 
               read_xlsx("../inputs/mobilityAH_edges_exampleWeights_20230629.xlsx")) %>%
  edgelist_to_igraph(vInfo = dv)
```
First we need to create a key to specify the positioning of vertices, in `AHgen` called a visKey. This could also be done in a .xlsx file externally and imported into R.
```{r}
visKey =
  tribble(
    ~layer, ~min, ~max, ~addR, ~r,
    1,250,290,0,1,
    2,250,290,0,2,
    3,260,280,0,3,
    4,260,280,0,4,
    5,250,290,0,5)

visKey
```

The `vis_AH_layout()` function generates a layout for visualising an Abstraction Hierarchy i.e. five-level hierarchical network. 

It has five input arguments:

- *edgelist* - the edge list of the network to be visualised
- *vInfo* - the vertex information
- *minSpacing* - the minimum spacing between nodes; by default this is set to `minSpacing = 0`
- *maxSpacing* - the maximum spacing between nodes; by default this is set to `maxSpacing = 100`
- *key* - the key to specify the visualisation layout

```{r}
plot_layout = 
  vis_AH_layout(edgelist = de,
                vInfo = dv,
                minSpacing = 0, 
                maxSpacing = 1000,
                key = visKey)

plot_layout
```

The function `vis_AH_ggplot()` generates a standard ggplot.

It has input arguments:

- *layout* - a layout generated by `vis_AH_layout()`
- *key* - the key to specify the visualisation layout; by default this is set to `key = NULL`
- *vecOpacity* - a vector of four numeric values representing the opacity of edges in each layer; by default this is set to `vecOpacity = c(1, 1, 1, 1)`
- *vecSize* - a vector of five numeric values representing the size of vertices in each level; by default this is set to `vecSize = c(5, 4, 3.5, 3, 2.5)`

```{r}
plot_ggplot = 
  vis_AH_ggplot(layout = plot_layout, 
                key = visKey)

plot_ggplot
```

Lastly is the function `vis_AH_plotly()`. Functions from the package `plotly` are used within `vis_AH_plotly()` to enable the visualisation to be interactive.

It has four input arguments:

- *ggplotPlot* - the plot generated with `vis_AH_ggplot()`
- *layerNames* - a vector of four character strings to be used as identifiers for Abstraction Hierarchy layers; by default this is set to `layerNames = c("Layer 1-2 - Purposes-Outcomes", "Layer 2-3 - Outcomes-Tasks", "Layer 3-4 - Tasks-Processes", "Layer 4-5 - Processes-Resources")`
- *levelNames* - a vector of five character strings to be used as identifiers for Abstraction Hierarchy levels; by default this is set to `levelNames = c("Level 1 - Purposes", "Level 2 - Outcomes", "Level 3 - Tasks", "Level 4 - Processes", "Level 5 - Resources")`
- *circles* - whether the visualisation should be circular; by default this is set to `circles = TRUE`

```{r} 
plot_plotly = 
  vis_AH_plotly(ggplotPlot = plot_ggplot)

plot_plotly
```

Using the building blocks above, it is possible to create an interactive version of an Abstraction Hierarchy. Below you can explore the AHexploreR, an application of this for a generic UK city (the Urban Systems Abstraction Hierarchy, or USAH). 

```{r, echo = FALSE}
knitr::include_app("https://mbedinger.shinyapps.io/AHexploreR/", height = "800px")
```


## 2. Visualising the results

This section covers pre-set output styles to visualise and explore the results of network analysis on Abstraction Hierarchies. These are fairly bespoke styles which can be adapted for your own purposes.

### 2.1. Plots


### 2.2. Tables

It is sometimes useful to summarise results in a table format for reports and academic papers. `AHgen` has several preset functions for this.


## Next
Next in [Vignette 7](Vignette-7), you will find out about... in `AHgen`.

## Last updated
This vignette is associated with `AHgen` v1.0.0, and was last updated by Melissa Bedinger on `r Sys.Date()`.